# Run docker-compose up
# Live long and prosper
version: '2'
services:
  rabbitmq:
    container_name: skf-rabbitmq_container
    image: rabbitmq:3.8.19
    environment:
        - RABBITMQ_DEFAULT_USER=admin
        - RABBITMQ_DEFAULT_PASS=admin-skf-secret
    ports:
        - "5672:5672"
        - "15672:15672"

  mysql:
    container_name: skf-mysql_container
    image: blabla1337/mysql
    restart: always
    environment:
      MYSQL_DATABASE: 'skf'
      MYSQL_ROOT_PASSWORD: 'admin-skf-secret'
      MYSQL_DEFAULT_PASS: 'admin-skf-secret'
      MYSQL_DEFAULT_USER: 'root'
    ports:
      - '3306:3306'
    volumes:
       - mysql_data:/var/lib/mysql

  nginx:
    container_name: skf-nginx_container
    restart: always
    image: nginx
    volumes:
      - ./site.conf:/etc/nginx/nginx.conf
    ports:
      - "80:80"

  skf-angular:
    container_name: skf-angular_container
    depends_on:
      - "rabbitmq"
      - "nginx"
      - "mysql"
    restart: always
    image: "blabla1337/skf-angular:4.1.0"
    environment:
      - FRONTEND_URI=http://localhost
      - SKIP_LOGIN=skiploginprovider

  skf-api:
    container_name: skf-api_container
    depends_on:
      - "rabbitmq"
      - "nginx"
      - "mysql"
    restart: always
    volumes:
      - /home/khundeck/.kube/config:/home/user_api/.kube/config
    image: "blabla1337/skf-api:4.1.0"
    environment:
      - SKF_FLASK_DEBUG=False
      - SKF_API_URL=http://127.0.0.1/api
      - SKF_TESTING=False
      - SKF_DB_URL=mysql+pymysql://root:admin-skf-secret@mysql/skf?charset=utf8mb4
      - SKF_JWT_SECRET=please_change_this_value_to_be_random
      - SKF_LABS_DOMAIN=http://192.168.58.2
      - SKF_LABS_DEPLOY_MODE=port
      - RABBIT_MQ_CONN_STRING=rabbitmq
      - LABS_KUBE_CONF=YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VSQ2FrTkRRV1UyWjBGM1NVSkJaMGxDUVZSQlRrSm5hM0ZvYTJsSE9YY3dRa0ZSYzBaQlJFRldUVkpOZDBWUldVUldVVkZFUlhkd2RHRlhOWEFLWVROV2FWcFZUa0pOUWpSWVJGUkplVTFVUVhkTmFrVTBUWHBaZDA0eGIxaEVWRTE1VFVScmVrMUVSVFJOZWxsM1RqRnZkMFpVUlZSTlFrVkhRVEZWUlFwQmVFMUxZbGRzZFdGWGRERlpiVlpFVVZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCUzIxQ0NtdERWVXBxUlZjMmMxRnJTWEJ0T1hCeVdYbHVNMWx3ZWpoQlVWWmtUelJOYUZOWVQweFdZVTV1YVRBNWRVdE9WMGw1ZVhwbVNUZEZNWGt3SzNaUFNta0tjbVp4UmsxTU1EWnJPR0ZSUzBkaVRqRm5kWFpoTTJoU2QxRkZSR1IwYXl0a2RqQlNTSE00ZUhKamFWWnpZMGtyVUZKdVlWZGFLMVo0UVdSUVZteExPQXB5WVhObGFsUkhkVEpDTWxZeVRWWm5VV0ZYVTBRMk5IUktjREpTYzB0Q05XbHpiVlZOTkUwMVptZHFTRk5qVVRkeFNqRk1NR2cxWW5sNk5sbFBUVFZrQ2tkT2NFVnZPRWN5ZFRFdlpUbGxNemhXWkdkeGRGcENkRk5IYVVkbmQyMVpjWGgwWlcxaGFIaGhLM0p2Y1dGTmNIUk5VMlJxTTFsVFptUTBkMjlNWVRBS1YzWTFXRUUzYjJFd2F6TTVkRzR4Tm1OaWNGZDZVV1pOVkdGdk9WRkxTVWRpTWxwUGFFZFhkelJCV0VGUFprOW1jRVpqTWk5VmExWTVVVFF5U1c5UU1BcDVlbWhFZDNkdU16TndRM0p3ZG1sT2NETnpRMEYzUlVGQllVNW9UVVk0ZDBSbldVUldVakJRUVZGSUwwSkJVVVJCWjB0clRVSXdSMEV4VldSS1VWRlhDazFDVVVkRFEzTkhRVkZWUmtKM1RVTkNaMmR5UW1kRlJrSlJZMFJCVkVGUVFtZE9Wa2hTVFVKQlpqaEZRbFJCUkVGUlNDOU5RakJIUVRGVlpFUm5VVmNLUWtKVFNVRmlLMGhIVXpWMlJUSk5XRzg0YlZwRWNtWnJNR3B4Y3pGRVFVNUNaMnR4YUd0cFJ6bDNNRUpCVVhOR1FVRlBRMEZSUlVGaVpWRkVabTluYWdwM1RIVjVWbWRDYld4VFV6ZHFjbVZNVFd3clRtNXhlSGxOYVZKSlRFaEhOa3B5YjNsdFpXRnRhRVEwYkN0V0wySXhTbTF5TVVaYWNHVlFRVmxZYjFSYUNuQmlZbTlxTlZkdWFHWlpjVGRCWjFaWlNUWmlRVXhtWXpoeVlrWmxka2xEVFV3MVpVMTBVMHB4ZUZWUWFDOUlTVGRuTDB0dFdGcENZV2c1WTJGV1NpOEtURWxyV25CbVZFdFBhbGRYWlZsUGVHeG5abk5JWld4dlUzaEJkM1JzTlZBekswcFNabWNyT1hSR0wwVXJhbUZQUjBGT1NIcEhjbWRRUTA5amRTOTNVUXBxU21vMVQxcHVSVFEyTUU0MVYzWmxNemh2VTFwVVZtZHBXVnBxVG1saFZucDJUbVJuTkc5MlRURjZlRTE0YUZOdlpubEJiWEpoY0ZoNVdqZG1abTFpQ2pWeE1WSjBOVEpKTm5JNE4wUTRRalJXTm1KUllXc3plVlp2TmpORFVFNXljRzlDYVVjd09ERlNRVFpaT1U4clltcFlOMGxMZFZwU1ZqUTFZa1ZoVURRS04xVnlSV0pxUjBFNVJtSmFaMmM5UFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2c9PQogICAgZXh0ZW5zaW9uczoKICAgIC0gZXh0ZW5zaW9uOgogICAgICAgIGxhc3QtdXBkYXRlOiBNb24sIDAzIE9jdCAyMDIyIDIxOjA1OjUzIEVEVAogICAgICAgIHByb3ZpZGVyOiBtaW5pa3ViZS5zaWdzLms4cy5pbwogICAgICAgIHZlcnNpb246IHYxLjI3LjAKICAgICAgbmFtZTogY2x1c3Rlcl9pbmZvCiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTkyLjE2OC41OC4yOjg0NDMKICBuYW1lOiBtaW5pa3ViZQpjb250ZXh0czoKLSBjb250ZXh0OgogICAgY2x1c3RlcjogbWluaWt1YmUKICAgIGV4dGVuc2lvbnM6CiAgICAtIGV4dGVuc2lvbjoKICAgICAgICBsYXN0LXVwZGF0ZTogTW9uLCAwMyBPY3QgMjAyMiAyMTowNTo1MyBFRFQKICAgICAgICBwcm92aWRlcjogbWluaWt1YmUuc2lncy5rOHMuaW8KICAgICAgICB2ZXJzaW9uOiB2MS4yNy4wCiAgICAgIG5hbWU6IGNvbnRleHRfaW5mbwogICAgbmFtZXNwYWNlOiBkZWZhdWx0CiAgICB1c2VyOiBtaW5pa3ViZQogIG5hbWU6IG1pbmlrdWJlCmN1cnJlbnQtY29udGV4dDogbWluaWt1YmUKa2luZDogQ29uZmlnCnByZWZlcmVuY2VzOiB7fQp1c2VyczoKLSBuYW1lOiBtaW5pa3ViZQogIHVzZXI6CiAgICBjbGllbnQtY2VydGlmaWNhdGUtZGF0YTogTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVUkpWRU5EUVdkdFowRjNTVUpCWjBsQ1FXcEJUa0puYTNGb2EybEhPWGN3UWtGUmMwWkJSRUZXVFZKTmQwVlJXVVJXVVZGRVJYZHdkR0ZYTlhBS1lUTldhVnBWVGtKTlFqUllSRlJKZVUxVVFYZE5la0Y0VFVSVk1FMVdiMWhFVkVreFRWUkJkMDE2UVhoTlJGVXdUVlp2ZDAxVVJWaE5RbFZIUVRGVlJRcERhRTFQWXpOc2VtUkhWblJQYlRGb1l6TlNiR051VFhoR2FrRlZRbWRPVmtKQlRWUkVWekZ3WW0xc2NtUlhTbXhNV0ZaNldsaEpkMmRuUldsTlFUQkhDa05UY1VkVFNXSXpSRkZGUWtGUlZVRkJORWxDUkhkQmQyZG5SVXRCYjBsQ1FWRkROQ3Q1VW5wVGF6WkxTVEp6WjNseU5URlJOSFZpZWxZd1kydEJRUzhLYmk5d056TjRLMjFGVGtsNWRXbEdTbWhxVUVoR0wxSjJNVUUxYVdGck1FcFdVa2R5T0VKMFoxY3JkRmhFVlhCUEswNHhTSFV3U0cxeWRFRkNjVEZHVGdwUU9GUnZNV2hGUVU5M1VVcEJkRmxoVEVvMVFsZzVibTFXWmpOMVNsWndkMDlFWjJsRVlYRmphSGRpYkhCaVEzRXlWVXQzVUZSUlpFbGFTSFZhYW01WENuSldNSFpPYkVWVWFrVXZUWFF5Y0ZkbWIwMTNRVWRSY1VvMWFEZzRWRXBZYlZwbFMwSkJZVXM1TTFsV0wxQXhka1pLUzBad1dTODJTbHBuZURReWNIa0thVkZaYWxKaVV5czNLMklyYVVwS1ptWTFXRzV3YmpKSVRIb3JaVUpIUldwTlZEaHdMMlY0U2xKdFdGQjVRMGxXYVVacmJIWlpVM0ZLUW1SdFVHWTBUd3BJV1dwdGNscDJReXRFTDFKT1JHZDRWM05ZTVdsWGJucFhNVzh5TVVoM2VqTXlaMlV4ZVZwYU1URnVLelZxUVdONFNtaHdVbE5PYWtGblRVSkJRVWRxQ2xsRVFtVk5RVFJIUVRGVlpFUjNSVUl2ZDFGRlFYZEpSbTlFUVdSQ1owNVdTRk5WUlVacVFWVkNaMmR5UW1kRlJrSlJZMFJCVVZsSlMzZFpRa0pSVlVnS1FYZEpkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZtUW1kT1ZraFRUVVZIUkVGWFowSlRTVUZpSzBoSFV6VjJSVEpOV0c4NGJWcEVjbVpyTUdweGN3b3hSRUZPUW1kcmNXaHJhVWM1ZHpCQ1FWRnpSa0ZCVDBOQlVVVkJWRWdyTUZVMFFUbEJWbGhYVFRWc1RrNWxiMUV2Tld0SWNubHNZMDVhUmtGb1lUUlZDbUpLT1U5cFVsbDNRWEp0WW5oV1lXaERTa3MzSzFBNVRucHFXSEZFTkN0SWNrVjVSMGQ2TjFSSlNIWkRLemhCYVhKU2NtaHdOV1IwZEZVeVFYbG5MMDhLWVZCUWJXNHpiSEJEVW5Oc1VrTjRUMmxVUm1kUmRDOVdVV000Tm1Fd2FYQnNiVlp3Ums1bmR6QnliMkZEWkRkVFIzWTBXbnBJVldWbWJ6VXJZMVkwY3dwd09ESmFNRmt6VnpoR1FuZFRNVkZrYlhVNUswWnNaemhwYTJOMFlrVXJVVkpZUzFab1pEZG9Za1lyTDBSQmJIWkNSVUY0Y1dSeE9XbFhValpUY0hkUkNtRjFPWFkxTUVOUlRqSXlhV280S3k5VllYWm9aek01VFdKMlpUZzNRVE5ZT0VrdmRHc3JRa04wYVZCM1pWTnZZM2hNWW1SUk9UWnhWV1ozZG5SVk5HRUtWVWswVVc0dlZrOHhObXhxZDJGaWEyRjRNMjFuV1VNckswRnlXRVpxWWxsT1IxWndOVEZFYldsd1kxZERZelZWYlhjOVBRb3RMUzB0TFVWT1JDQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENnPT0KICAgIGNsaWVudC1rZXktZGF0YTogTFMwdExTMUNSVWRKVGlCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRcE5TVWxGYjNkSlFrRkJTME5CVVVWQmRWQnphMk13Y0U5cGFVNXlTVTF4SzJSVlQweHRPREZrU0VwQlFWQTFMelpsT1RobWNHaEVVMDF5YjJoVFdWbDZDbmg0WmpCaU9WRlBXVzF3VGtOV1ZWSnhMMEZpV1VaMmNsWjNNVXRVZG1wa1VqZDBRalZ4TjFGQllYUlNWRlF2UlRaT1dWSkJSSE5GUTFGTVYwZHBlV1VLVVZZdldqVnNXRGszYVZaaFkwUm5ORWxuTW5GdVNXTkhOV0ZYZDNGMGJFTnpSREF3U0ZOSFVqZHRXVFV4Y1RGa1RIcGFVa1UwZUZCNlRHUnhWbTQyUkFwTlFVSnJTMmxsV1daUVJYbFdOVzFZYVdkUlIybDJaREpHWm5vNVluaFRVMmhoVjFBcmFWZFpUV1ZPY1dOdmEwZEpNRmN3ZG5VdmJTOXZhVk5ZTXl0V0NqVTJXamxvZVRndmJtZFNhRWw2UlM5TFpqTnpVMVZhYkhvNFoybEdXV2hhU21JeVJYRnBVVmhhYWpNclJHZ3lTVFZ4TW1KM2RtY3ZNRlJSTkUxV2NrWUtPVmxzY0RneGRHRk9kRkk0VFRrNWIwaDBZMjFYWkdSYUwzVlpkMGhOVTFsaFZWVnFXWGRKUkVGUlFVSkJiMGxDUVVSV1NtRXpkVzExVXpsRUszSldUUXByYTJJelpWUXdaR3RMWjAxME0xZGpiMU41VkROMWMxbDRNbE5FYURsc1JsSndPR2QzU0V0RFpFMDFWemQyUVRCVFJUTjFZMmRTTVVacWRGTm5ZMmd3Q2tkc1NubHRRVFZoTlRKTVJIUnFlalZzVFVNMlFXUlhLMHR1UW5GR09FVmpaakEwTTNwWE5YbzRVakZ6VG5wNFEyaGlSVkp1VFdSUloyMVZaazFQUWxjS2FUaGFNMHQzT0VaUU5rOWpXVk5pT1dNck1rbDVVbmhJWmtOc2RGa3dXbm8wTnpGemNuRnBTbGRCTTNWdlkwbzBlVlZCVjJWU1VGUXhXV1ZNVjI5aFJ3cGxiRVp0V0ZOS05XY3dXSGhoV2xFM1dqaEJSVzFMU25wcFlYTnNSbTlDSzFKT1ZXVjVXR0ZrY2pZM01UTlVVM1V3V0haak5ESlNjbFZKTW5oWmVHOU9DbFo1ZEU0NFpFaGlaM1JRV2l0bGNrNWhSVU5yZUVWcGNtZ3ZjVE1yT1hJeksyOW5WRzVEVkRkaFkyeHFaRkpuUjNkSFJTOVlWSFp5YmtkQ1dsbG1abWdLUlVaT2J5OTVSVU5uV1VWQk1GbFhhMmh4Y0ZoWFkyVlNhVWRtZEdObllXVkthREF4YnpkSVlrNXRiRVprTURWSFpuSnpNR2h2VlhGek4zQTBNWE5TZGdwNlJVZ3ZkVWxpTmtOQlNFSnVTa2x3UlVSQ1ZUZGtOSGxZVFU0ME5taDRiVUppTWpscVZtRjVOWFpWY1VSeldGZHRaVGhWZWxWSVVDOXhkR3g0V2l0R0NuTm1UbFpZZWxsUmEydzBXVmQxTWtObVowNXBhbTlzTDBwU2FXWkZSRlpFYTFFelFqQjJXRzA1V0RsUGRsUXZWWFpzZVdzd1drMURaMWxGUVRSblVHTUtkRnBzVG14NU1GRnFiVkJsTWpodFpWWklNVmM0Ymtob1FUTXhNazVGZFVKaFZGVklTRXh3WW5CYVIyVlhkMlo1YkVsc2FURlJaVXBCYld0YVNFcGljQXBRVFM5b2FVdFVhMEV4U1RkWFdtZEdhRVZRV2pObWJFOVZRVkkyV25Sc1NVNU5WWHBZWW5wWUx6bGxaa3BxZWtsWWMzUmlSMVZNYVVjck56Tm1VVFpxQ2swd1VXVjZTMkl3VWtOSE1FMURheXRZV1VKQloyZG9NMFZTTlVkUmNYSklTa1ZwTjNsUVJVTm5XVVZCZHpoNmRIQlFPVFZLUTJsU1VUTldSQ3M0VW1RS1pFOWliRWx5V0hGVmVETnlNR2RQZG1NeU1rWk9OVlZ3UVRnM2JXTkhXV2Q1UkZOQ1VYSlBORFF4VTI4eE5saHlaeTl3TWpBNWFFeElhemsyU25WWmJBcElXVnByY0hKdU16bEZaakphZEc1U2NFRmpLMWhHWWpsb2JGRnphSEJPSzFGSU9WUk1LMlkxWTNBNVIybFhjbVZCVGpoMU9HdzVhVVkwZFRjd2EzcEZDbVZOUkhabGFrNWtRVGt4Vml0NGRUQjBOMVZwVUdOelEyZFpRbGhFTnk5TlNVVkxXVTFzTjBoVGMyUkdRMHhSTlhaYVNuQnFPVFZ4WkhORE5uZHFPRmNLV2t4MldtOUNkUzlsYjJ4NVlsZDRVRTVYUkdoNVMxcEtWRWQ2UlRZMGFuRjVVRlZMY1hWSEswOWpXSE0zUkdSeWVrdHpNall4Y2pCVVpGWk5iWFpTU3dwb05VRlRNSEpUZEhNNFVqRmxWVXRDTmxodGRFVkhkVU00VW14aGFtWkliSGhLTjAxdVNqbEtVVEphYVdsMlEyZEhaRUV2YUhJd0t6RmtaV2Q0UzBsNkNsbDFWV0pOVVV0Q1owTlJkakZQTW13eWNVSkNOREV3VlZCWWIxSTRPRE01YmxBeVZXNHJPRFpQVlU4NU4wazBUVUZEZWpkVFFYTjVVMnAzY0ZBMGFGZ0tlR2cxT1dGcGVHaG1OSGxDZVZOT1QwdHpibTQzS3pOemVTdG1iVEV4TVdFMGFHRjFNRzh6VEdOMVNUWmxaMGRFVURGclNUUkljMWRuY0RoUlNWcHVRUXBZUW1jMGNFTXlOMDFqVjI5d1EySkZaV2wxZEVSMmFVMXRVVGhQWjBSRE9TOVRWeTlRTkVKUVJWcEJWRUZwYW1NdlEzbEdDaTB0TFMwdFJVNUVJRkpUUVNCUVVrbFdRVlJGSUV0RldTMHRMUzB0Q2c9PQo=
      #- LABS_KUBE_CONF=base64_string_here_of_the_content_of_the .kube/config file_for_example: cat ~/.kube/config | base64      
      #- GOOGLE_CREDENTIALS=base64_string_here_of_the_content_of_the gsa-key.json file_for_example: cat gsa-key.json | base64
      #- SKF_LABS_DEPLOY_MODE=subdomain
      #- JWT_ENABLED="False"
      #- SKF_DOJO_API_KEY=
volumes:
  mysql_data: {}
